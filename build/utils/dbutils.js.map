{"version":3,"sources":["../../server/utils/dbutils.js"],"names":["connect","listItems","createItem","deleteItem","updateItemRate","addItemComment","RateItem","model","host","port","name","set","filter","find","data","rateItem","rate","count","description","save","id","findById","remove","department","resolve","reject","findOne","err","console","log","detailInfo","concat","date","Date","now","then","length","text","undefined","newData","comment"],"mappings":";;;;;;;;;;;;;;QAOgBA,O,GAAAA,O;QAKAC,S,GAAAA,S;QAIAC,U,GAAAA,U;QAWAC,U,GAAAA,U;QAIAC,c,GAAAA,c;QAsBAC,c,GAAAA,c;;AArDhB;;;;AACA;;AACA;;;;AAGA,IAAMC,WAAW,mBAASC,KAAT,CAAe,UAAf,CAAjB;;AAEO,SAASP,OAAT,GAAmB;AACtB,uBAASA,OAAT,gBAA8B,WAAGQ,IAAjC,SAAyC,WAAGC,IAA5C,SAAoD,WAAGC,IAAvD;AACA,uBAASC,GAAT,CAAa,OAAb,EAAsB,IAAtB;AACH;;AAEM,SAASV,SAAT,CAAmBW,MAAnB,EAA2B;AAC9B,WAAON,SAASO,IAAT,CAAcD,MAAd,CAAP;AACH;;AAEM,SAASV,UAAT,CAAoBY,IAApB,EAA0B;AAC7B,QAAMC,WAAW,IAAIT,QAAJ,CAAa;AAC1BI,cAAMI,KAAKJ,IADe;AAE1BM,cAAMF,KAAKE,IAFe;AAG1BC,eAAOH,KAAKG,KAHc;AAI1BC,qBAAaJ,KAAKI;AAJQ,KAAb,CAAjB;;AAOA,WAAOH,SAASI,IAAT,EAAP;AACH;;AAEM,SAAShB,UAAT,CAAoBiB,EAApB,EAAwB;AAC3B,WAAOd,SAASe,QAAT,CAAkBD,EAAlB,EAAsBE,MAAtB,EAAP;AACH;;AAEM,SAASlB,cAAT,CAAwBmB,UAAxB,EAAoCP,IAApC,EAA0C;;AAE7C,WAAO,sBAAY,UAACQ,OAAD,EAAUC,MAAV,EAAqB;AACpCnB,iBAASoB,OAAT,CAAiB,EAAChB,MAAMa,UAAP,EAAjB,EAAqC,UAACI,GAAD,EAAMZ,QAAN,EAAmB;AACpD,gBAAIY,GAAJ,EAAS,OAAOC,QAAQC,GAAR,CAAYF,GAAZ,CAAP;AACTZ,qBAASC,IAAT,GAAgB,CAACD,SAASC,IAAT,GAAgBD,SAASE,KAAzB,GAAiCD,IAAlC,KAA2CD,SAASE,KAAT,GAAiB,CAA5D,CAAhB;AACAF,qBAASE,KAAT,IAAkB,CAAlB;AACAF,qBAASe,UAAT,GAAsBf,SAASe,UAAT,CAAoBC,MAApB,CAA2B;AAC7Cd,uBAAOF,SAASE,KAD6B;AAE7Ce,sBAAMC,KAAKC,GAAL,EAFuC;AAG7ClB,sBAAMA;AAHuC,aAA3B,CAAtB;AAKAD,qBAASI,IAAT;AACH,SAVD,EAUGgB,IAVH,CAUQ,gBAAQ;;AAEZX,oBAAQV,KAAKgB,UAAL,CAAgBM,MAAxB;AAEH,SAdD;AAgBH,KAjBM,CAAP;AAkBH;;AAEM,SAAS/B,cAAT,CAAwBkB,UAAxB,EAAoCN,KAApC,EAA2CoB,IAA3C,EAAiD;AACpD,QAAIA,SAASC,SAAb,EAAwBD,OAAO,aAAP;AACxB/B,aAASoB,OAAT,CAAiB,EAAChB,MAAMa,UAAP,EAAjB,EAAqC,UAACI,GAAD,EAAMZ,QAAN,EAAmB;AACpD,YAAIwB,UAAU,sBAAc,EAAd,EAAkBxB,SAASe,UAA3B,CAAd;AACAS,gBAAQtB,KAAR,IAAiB,sBAAc,EAAd,EAAmBsB,QAAQtB,KAAR,CAAnB,EAAmC,EAACuB,SAASH,IAAV,EAAnC,CAAjB;AACAtB,iBAASe,UAAT,GAAsBS,OAAtB;AACAxB,iBAASI,IAAT;AAEH,KAND;AAOH;;;;;;;;kCAzDKb,Q;;kCAEUN,O;;kCAKAC,S;;kCAIAC,U;;kCAWAC,U;;kCAIAC,c;;kCAsBAC,c","file":"dbutils.js","sourcesContent":["import mongoose from 'mongoose';\nimport '../models/RateItem';\nimport {db} from '../config/config.json';\n\n\nconst RateItem = mongoose.model('RateItem');\n\nexport function connect() {\n    mongoose.connect(`mongodb://${db.host}:${db.port}/${db.name}`);\n    mongoose.set(\"debug\", true);\n}\n\nexport function listItems(filter) {\n    return RateItem.find(filter);\n}\n\nexport function createItem(data) {\n    const rateItem = new RateItem({\n        name: data.name,\n        rate: data.rate,\n        count: data.count,\n        description: data.description,\n    });\n\n    return rateItem.save();\n}\n\nexport function deleteItem(id) {\n    return RateItem.findById(id).remove();\n}\n\nexport function updateItemRate(department, rate) {\n\n    return new Promise((resolve, reject) => {\n        RateItem.findOne({name: department}, (err, rateItem) => {\n            if (err) return console.log(err);\n            rateItem.rate = (rateItem.rate * rateItem.count + rate) / (rateItem.count + 1);\n            rateItem.count += 1;\n            rateItem.detailInfo = rateItem.detailInfo.concat({\n                count: rateItem.count,\n                date: Date.now(),\n                rate: rate,\n            });\n            rateItem.save();\n        }).then(data => {\n\n            resolve(data.detailInfo.length);\n\n        });\n\n    });\n}\n\nexport function addItemComment(department, count, text) {\n    if (text === undefined) text = 'No comments';\n    RateItem.findOne({name: department}, (err, rateItem) => {\n        let newData = Object.assign([], rateItem.detailInfo);\n        newData[count] = Object.assign({},  newData[count], {comment: text});\n        rateItem.detailInfo = newData;\n        rateItem.save();\n\n    });\n}\n"]}