{"version":3,"sources":["../../server/utils/dbutils.js"],"names":["connect","listItems","createItem","deleteItem","updateItemRate","addItemComment","RateItem","model","set","filter","find","data","rateItem","name","rate","count","description","save","id","findById","remove","department","resolve","reject","findOne","err","console","log","detailInfo","concat","date","Date","now","then","length","text","undefined","newData","comment"],"mappings":";;;;;;;;;;;;;;QAOgBA,O,GAAAA,O;QAMAC,S,GAAAA,S;QAIAC,U,GAAAA,U;QAWAC,U,GAAAA,U;QAIAC,c,GAAAA,c;QAsBAC,c,GAAAA,c;;AAtDhB;;;;AACA;;AACA;;;;AAGA,IAAMC,WAAW,mBAASC,KAAT,CAAe,UAAf,CAAjB;;AAEO,SAASP,OAAT,GAAmB;AACvB;AACC,uBAASA,OAAT;AACA,uBAASQ,GAAT,CAAa,OAAb,EAAsB,IAAtB;AACH;;AAEM,SAASP,SAAT,CAAmBQ,MAAnB,EAA2B;AAC9B,WAAOH,SAASI,IAAT,CAAcD,MAAd,CAAP;AACH;;AAEM,SAASP,UAAT,CAAoBS,IAApB,EAA0B;AAC7B,QAAMC,WAAW,IAAIN,QAAJ,CAAa;AAC1BO,cAAMF,KAAKE,IADe;AAE1BC,cAAMH,KAAKG,IAFe;AAG1BC,eAAOJ,KAAKI,KAHc;AAI1BC,qBAAaL,KAAKK;AAJQ,KAAb,CAAjB;;AAOA,WAAOJ,SAASK,IAAT,EAAP;AACH;;AAEM,SAASd,UAAT,CAAoBe,EAApB,EAAwB;AAC3B,WAAOZ,SAASa,QAAT,CAAkBD,EAAlB,EAAsBE,MAAtB,EAAP;AACH;;AAEM,SAAShB,cAAT,CAAwBiB,UAAxB,EAAoCP,IAApC,EAA0C;;AAE7C,WAAO,sBAAY,UAACQ,OAAD,EAAUC,MAAV,EAAqB;AACpCjB,iBAASkB,OAAT,CAAiB,EAACX,MAAMQ,UAAP,EAAjB,EAAqC,UAACI,GAAD,EAAMb,QAAN,EAAmB;AACpD,gBAAIa,GAAJ,EAAS,OAAOC,QAAQC,GAAR,CAAYF,GAAZ,CAAP;AACTb,qBAASE,IAAT,GAAgB,CAACF,SAASE,IAAT,GAAgBF,SAASG,KAAzB,GAAiCD,IAAlC,KAA2CF,SAASG,KAAT,GAAiB,CAA5D,CAAhB;AACAH,qBAASG,KAAT,IAAkB,CAAlB;AACAH,qBAASgB,UAAT,GAAsBhB,SAASgB,UAAT,CAAoBC,MAApB,CAA2B;AAC7Cd,uBAAOH,SAASG,KAD6B;AAE7Ce,sBAAMC,KAAKC,GAAL,EAFuC;AAG7ClB,sBAAMA;AAHuC,aAA3B,CAAtB;AAKAF,qBAASK,IAAT;AACH,SAVD,EAUGgB,IAVH,CAUQ,gBAAQ;;AAEZX,oBAAQX,KAAKiB,UAAL,CAAgBM,MAAxB;AAEH,SAdD;AAgBH,KAjBM,CAAP;AAkBH;;AAEM,SAAS7B,cAAT,CAAwBgB,UAAxB,EAAoCN,KAApC,EAA2CoB,IAA3C,EAAiD;AACpD,QAAIA,SAASC,SAAb,EAAwBD,OAAO,aAAP;AACxB7B,aAASkB,OAAT,CAAiB,EAACX,MAAMQ,UAAP,EAAjB,EAAqC,UAACI,GAAD,EAAMb,QAAN,EAAmB;AACpD,YAAIyB,UAAU,sBAAc,EAAd,EAAkBzB,SAASgB,UAA3B,CAAd;AACAS,gBAAQtB,KAAR,IAAiB,sBAAc,EAAd,EAAmBsB,QAAQtB,KAAR,CAAnB,EAAmC,EAACuB,SAASH,IAAV,EAAnC,CAAjB;AACAvB,iBAASgB,UAAT,GAAsBS,OAAtB;AACAzB,iBAASK,IAAT;AAEH,KAND;AAOH;;;;;;;;kCA1DKX,Q;;kCAEUN,O;;kCAMAC,S;;kCAIAC,U;;kCAWAC,U;;kCAIAC,c;;kCAsBAC,c","file":"dbutils.js","sourcesContent":["import mongoose from 'mongoose';\nimport '../models/RateItem';\nimport {db} from '../config/config.json';\n\n\nconst RateItem = mongoose.model('RateItem');\n\nexport function connect() {\n   // mongoose.connect(`mongodb://${db.host}:${db.port}/${db.name}`);\n    mongoose.connect(`mongodb://juff:Splurgeola4848@ds161913.mlab.com:61913/heroku_s02vjssr`);\n    mongoose.set(\"debug\", true);\n}\n\nexport function listItems(filter) {\n    return RateItem.find(filter);\n}\n\nexport function createItem(data) {\n    const rateItem = new RateItem({\n        name: data.name,\n        rate: data.rate,\n        count: data.count,\n        description: data.description,\n    });\n\n    return rateItem.save();\n}\n\nexport function deleteItem(id) {\n    return RateItem.findById(id).remove();\n}\n\nexport function updateItemRate(department, rate) {\n\n    return new Promise((resolve, reject) => {\n        RateItem.findOne({name: department}, (err, rateItem) => {\n            if (err) return console.log(err);\n            rateItem.rate = (rateItem.rate * rateItem.count + rate) / (rateItem.count + 1);\n            rateItem.count += 1;\n            rateItem.detailInfo = rateItem.detailInfo.concat({\n                count: rateItem.count,\n                date: Date.now(),\n                rate: rate,\n            });\n            rateItem.save();\n        }).then(data => {\n\n            resolve(data.detailInfo.length);\n\n        });\n\n    });\n}\n\nexport function addItemComment(department, count, text) {\n    if (text === undefined) text = 'No comments';\n    RateItem.findOne({name: department}, (err, rateItem) => {\n        let newData = Object.assign([], rateItem.detailInfo);\n        newData[count] = Object.assign({},  newData[count], {comment: text});\n        rateItem.detailInfo = newData;\n        rateItem.save();\n\n    });\n}\n"]}